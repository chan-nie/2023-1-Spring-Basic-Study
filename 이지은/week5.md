# 스프링 DB 접근 기술
* H2 데이터베이스
* 순수 Jdbc
    * 데이터베이스와 서버를 연결해주는 기술
    * 개발 하기 힘들다
* 스프링 통합 테스트
* 스프링 JdbcTemplate
    * 순수 Jdbc -> 스프링이 중복을 제거해줌
* JPA
    * sql도 대신해주는 기술 
    * 객체를 바로 DB에 쿼리 없이 저장하고 관리 가능
* 스프링 데이터 JPA

## 01. H2 데이터베이스 설치

H2 데이터베이스 : 개발이나 테스트 용도로 가볍고 편리한 DB, 웹 화면을 제공해줌

- 최초에는 jdbc:h2:~/test 파일로 접근
- 이후부터는 jdbc:h2:tcp://localhost/~/test으로 소켓을 통하여 접근 


- 테이블 생성 : H2데이터베이스에 접근해서 member 테이블 생성
~~~
drop table if exists member CASCADE;
create table member
(
 id bigint generated by default as identity, //id와 name을 받음
 name varchar(255),
 primary key (id)
);
~~~

    - select * from member을 통해 조회 가능
    - member의 id : bigint 타입, null 값이 들어오면 db가 알아서 채워줌
    - insert into member(name) values('spring) : 조회하면 id가 1, name이 spring으로 생성됨 

## 02. 순수 Jdbc

- build.gradle 파일에 jdbc, h2 데이터베이스 관련 라이브러리 추가

~~~
implementation 'org.springframework.boot:spring-boot-starter-jdbc'
runtimeOnly 'com.h2database:h2'
~~~

- 스프링부트 데이터베이스 연결 설정 추가

~~~
spring.datasource.url=jdbc:h2:tcp://localhost/~/test
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.username=sa //스프링 2.4부터 빠지면 오류
~~~

- Jdbc 회원 리포지토리 변경
- 스프링 설정 변경(SpringConfig)
    - MemoryMemberRepository() -> JdbcMemberRepository(dataSource)


## 03. 스프링 통합 테스트

- @SpringBootTest : 스프링 컨테이너와 테스트를 함께 실행
- @Transactional : 테스트 시작 전에 트랜잭션을 시작하고, 테스트 완료 후에 항상 롤백한다 -> DB에 데이터가 남지 않으므로 다음 테스트에 영향 X
    - 테스트는 반복할 수 있어야 함(다음 테스트에 영향을 주면 안됨)
    - 이전에는 @AfterEeach로 구현

    


